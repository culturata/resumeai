generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum SubscriptionStatus {
  FREE
  ACTIVE
  CANCELLED
  PAST_DUE
}

enum FileType {
  PDF
  MARKDOWN
}

enum ApplicationStatus {
  DRAFT
  APPLIED
  INTERVIEWING
  REJECTED
  ACCEPTED
}

model User {
  id                  String              @id
  email               String              @unique
  createdAt           DateTime            @default(now())
  subscriptionStatus  SubscriptionStatus  @default(FREE)
  stripeCustomerId    String?             @unique
  stripeSubscriptionId String?            @unique
  currentPeriodEnd    DateTime?

  resumes             Resume[]
  jobApplications     JobApplication[]

  @@map("users")
}

model Resume {
  id                String      @id @default(cuid())
  userId            String
  originalFileName  String
  originalFileUrl   String
  fileType          FileType
  originalContent   String      @db.Text
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  user              User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobApplications   JobApplication[]

  @@map("resumes")
  @@index([userId])
}

model JobApplication {
  id                      String             @id @default(cuid())
  userId                  String
  resumeId                String
  jobTitle                String
  companyName             String
  jobDescriptionUrl       String?
  jobDescriptionText      String             @db.Text
  optimizedResumeContent  String             @db.Text
  optimizedResumeUrl      String?
  status                  ApplicationStatus  @default(DRAFT)
  appliedAt               DateTime?
  createdAt               DateTime           @default(now())
  updatedAt               DateTime           @updatedAt
  notes                   String?            @db.Text

  user                    User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  resume                  Resume             @relation(fields: [resumeId], references: [id], onDelete: Cascade)
  coverLetters            CoverLetter[]

  @@map("job_applications")
  @@index([userId])
  @@index([resumeId])
  @@index([status])
}

model CoverLetter {
  id                String         @id @default(cuid())
  jobApplicationId  String
  content           String         @db.Text
  createdAt         DateTime       @default(now())

  jobApplication    JobApplication @relation(fields: [jobApplicationId], references: [id], onDelete: Cascade)

  @@map("cover_letters")
  @@index([jobApplicationId])
}
